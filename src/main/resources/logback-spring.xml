<?xml version="1.0" encoding="UTF-8"?>
<configuration scan="true">

    <!--  Cấu hình pattern hiển thị log -->
    <property name="LOG_PATTERN"
              value="%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"/>

    <!--  Môi trường -->
    <springProperty scope="context" name="springAppName" source="spring.application.name" defaultValue="authentication-service"/>

    <!--  Console Appender (hiển thị log trong terminal) -->
    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!--  File Appender (ghi log ra file, chia theo ngày) -->
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>logs/${springAppName}.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!-- Tên file log theo ngày -->
            <fileNamePattern>logs/${springAppName}-%d{yyyy-MM-dd}.log</fileNamePattern>
            <maxHistory>15</maxHistory> <!-- Lưu log 15 ngày -->
        </rollingPolicy>

        <encoder>
            <pattern>${LOG_PATTERN}</pattern>
        </encoder>
    </appender>

    <!-- Log riêng cho Hibernate (giảm bớt noise) -->
    <logger name="org.hibernate" level="WARN"/>
    <logger name="org.springframework.security" level="INFO"/>
    <logger name="org.springframework.web" level="INFO"/>

    <!-- Root logger (áp dụng chung) -->
    <root level="INFO">
        <appender-ref ref="CONSOLE"/>
        <appender-ref ref="FILE"/>
    </root>

</configuration>
